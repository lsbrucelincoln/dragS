!function(e){function t(t){var n=e.extend(!0,{},s,t),r=this;r.o=n,r.isDrag=!1,r.hasChosen=!1,r.setJqueryFunction(),r.initArea(),r.insertSelection(),r.initBind()}function n(){var t=[];return e(".dragElement").each(function(n,r){t[n]={},t[n].y1=e(r).offset().top,t[n].y2=e(r).offset().top+e(r).height(),t[n].x1=e(r).offset().left,t[n].x2=e(r).offset().left+e(r).width()}),t}function r(e,n){this.$this=e,t.call(this,n)}if("undefined"==typeof e)throw new Error("dragS's script requires jQuery");var a=null,s={player:null,giver:null,receiver:null,mode:"nornal",dragElement:null,noDragElement:null,chooseElement:function(){},cancelChoose:function(){}};e.extend(r.prototype,{setJqueryFunction:function(){var t=this;e.fn.extend({chosenDragElement:function(){this.addClass("chosenDragElement"),t.o.chooseElement(this)},removeChosenElement:function(){this.removeClass("chosenDragElement"),t.o.cancelChoose(this)}})},initBind:function(){var t,r,a=this,s=a.$this;s.on("mousedown",function(n){console.log(a.startMove),a.startMove||(e(".dragGiver .dragElement").removeChosenElement(),a.hasChosen=!1),a.startMove=!1,console.log("down"),t=n.clientX,r=n.clientY,e(".dragSelection").css({left:t,top:r+e("body").scrollTop()}).css("border","1px solid #000"),a.isDrag=!0}),s.on("mousemove",function(n){return a.isDrag?void(a.hasChosen||(e(".dragSelection").show().css({width:Math.abs(n.clientX-t),height:Math.abs(n.clientY-r)}),n.clientY-r<0&&n.clientX-t>0&&e(".dragSelection").css({left:t,top:n.clientY+e("body").scrollTop()}),n.clientX-t<0&&n.clientY-r>0&&e(".dragSelection").css({left:n.clientX,top:r+e("body").scrollTop()}),n.clientX-t<0&&n.clientY-r<0&&e(".dragSelection").css({left:n.clientX,top:n.clientY+e("body").scrollTop()}))):!1}),s.on("mouseup",function(n){if(!a.isDrag)return!1;console.log("up"),a.isDrag=!1,e(".dragSelection").hide().css({width:Math.abs(n.clientX-t),height:Math.abs(n.clientY-r)});for(var s=0;s<a.leftList.length;s++)a.leftList[s].y1>parseInt(e(".dragSelection").css("top"))&&a.leftList[s].y2<parseInt(e(".dragSelection").css("top"))+parseInt(e(".dragSelection").css("height"))&&a.leftList[s].x1<parseInt(e(".dragSelection").css("left"))+parseInt(e(".dragSelection").css("width"))&&a.leftList[s].x2>parseInt(e(".dragSelection").css("left"))&&e(".dragElement").eq(s).chosenDragElement();e(".dragGiver .chosenDragElement").length>0&&(a.hasChosen=!0)}),s.on("click",".dragGiver .dragElement",function(t){console.log("click"),t.stopPropagation(),e(this).hasClass("chosenDragElement")?(e(this).removeChosenElement(),a.startMove=!1):(e(this).chosenDragElement(),a.hasChosen=!0)}),s.on("mousedown",".dragElement ",function(){a.startMove=!0,console.log(a.startMove)});s.on("dragstart",".dragGiver",function(t){var n=e(t.target).clone().empty();return n.append(e(t.target).find(".chosenDragElement").clone()),console.log(n[0]),t.dataTransfer=t.originalEvent.dataTransfer,console.log(t.dataTransfer),t.dataTransfer.setData("text",n[0].innerHTML),t.dataTransfer.setDragImage(n[0],0,0),!0}),s.on("dragend"," .dragGiver",function(){return!0}),s.on("dragover",".dragReceiver",function(t){t.preventDefault(),e(".selection").hide()}),s.on("drop",".dragReceiver",function(){console.log("test"),e(this).append(e(".dragGiver").children(".chosenDragElement")),a.hasChosen=!1,a.isDrag=!1,a.leftList=n(),e(".dragGiver .dragElement").removeChosenElement()})},insertSelection:function(){var t=this,n=t.$this,r=e("<div class='dragSelection'>");r.css({position:"absolute",display:"none"}),n.append(r)},initArea:function(){var t=this,r=t.$this,a=t.o;console.log(a),t.leftList=[],a.player||a.giver||a.giver?(a.player&&e(a.player).each(function(t,n){e(n).hasClass("dragGiver")||e(n).hasClass("dragReceiver")||e(n).addClass("dragGiver dragReceiver").attr("draggable","true")}),a.giver&&e(a.giver).each(function(t,n){e(n).hasClass("dragGiver")||e(n).addClass("dragGiver").attr("draggable","true")}),a.receiver&&e(a.receiver).each(function(t,n){e(n).hasClass("dragReceiver")||e(n).addClass("dragReceiver").attr("draggable","true")})):r.children().each(function(t,n){e(n).hasClass("dragGiver")||e(n).hasClass("dragReceiver")||e(n).addClass("dragGiver dragReceiver").attr("draggable","true")}),a.dragElement?e(a.dragElement).each(function(t,n){e(n).hasClass("dragElement")||e(n).addClass("dragElement")}):e(".dragGiver").children().each(function(t,n){e(n).hasClass("dragElement")||e(n).addClass("dragElement")}),console.log(a.noDragElement),a.noDragElement&&e(".dragGiver").children(a.noDragElement).removeClass("dragElement"),t.leftList=n()}}),e.fn.dragS=function(t){return a||(a=new r(e(this),t)),this},e.fn.dragS.version="0.1.0",e.each(["initArea"],function(t,n){e.fn.dragS[n]=function(){return a?a[n].apply(a,[].slice.call(arguments,0)):0}})}(jQuery,window);